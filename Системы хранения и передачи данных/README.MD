# Домашнее задание к занятию "`Базы данных, их типы`" - `Гаврилова Валерия`

### Задание 1

1.1. Бюджетирование и финансы
Для бюджета, отчетов и прогнозирования критически важна точность, никаких потерь данных и чёткая структура. Для этих задач подходит классическая реляционная база (SQL), типа PostgreSQL или Microsoft SQL Server.
Если хеширование (например, шифрование паролей) стало тормозить: Можно поручить эту задачу специальным облачным сервисам от AWS или Google Cloud, которые заточены под быстрые криптографические операции. Или просто кэшировать результаты, чтобы не вычислять каждый раз заново.

1.2. Лендинги и CRM
Лендинги — сайты-одностраничники, куда приходят потенциальные клиенты. Данные могут быть разными, структура часто меняется. Нужна скорость. MongoDB (гибкая документная база) идеально для этого подходит. CRM — система для менеджеров по продажам. Там уже больше порядка, но тоже нужна гибкость. Для CRM — можно тоже реляционную (PostgreSQL) или современную гибридную.
PostgreSQL умеет хранить и строгие таблицы (для CRM), и гибкие документы в формате JSON (для данных с лендингов). Он подойдет для обетх этих задач. Это будет удобно и для разработки, и для анализа.

1.3. База знаний компании (нормы, правила, обучение)
Хранить документы, инструкции, обучающие материалы нужно так, чтобы было понятно, к какому отделу что относится. На самом деле, сойдёт та же реляционная база (например, PostgreSQL). В ней можно создать таблицу "Документы" и указывать для каждого документа его "родительский" раздел. Получится понятное древо.
Можно использовать уже существующую базу. Если для финансов или CRM уже стоит PostgreSQL, то можно создать в ней отдельный набор таблиц для этих корпоративных знаний. Это проще и дешевле, чем ставить новую систему.

1.4. Логистика (маршруты доставки, курьеры)
Строить оптимальные маршруты между объектами, быстро находить связи (какой склад ближе к стройке, какого курьера назначить). Здесь важны именно связи между точками. Лучше всего — графовая база данных (например, Neo4j). Она мыслит именно категориями "точек" и "связей" между ними, что идеально для маршрутизации.
Лучше подключить отдел закупок отдельно, но связать. Закупки — это больше про учёт материалов, поставщиков, договоры. Им удобнее в реляционной базе. Но их база должна быть тесно интегрирована с логистической, чтобы при формировании маршрута сразу было видно, какой материал откуда везти. Можно использовать разные специализированные системы, которые общаются между собой через общий интерфейс (API).

1.5. А можно ли вообще всё сделать на одной базе данных?
Технически — да. Мощная универсальная база вроде PostgreSQL справится со всеми задачами: финансами, CRM и лендингами, базой знаний, логистикой.
Но если компания большая и задачи серьёзные, часто разумнее выбрать 2-3 разные базы, идеально заточенные под свои цели (например, PostgreSQL для структурированных данных и Neo4j для логистики), и научить их общаться между собой. Это даст большую производительность и гибкость в долгосрочной перспективе.
```

### Задание 2
 2.1. Обычное пополнение баланса (пользователь сам инициирует)
Инициирование: Система (приложение или сайт оператора) создаёт новую «транзакцию» — временную рабочую область, где все изменения будут промежуточными, пока всё не завершится.
Проверка платёжного шлюза: Приложение связывается с платёжной системой (банк, Qiwi и т.п.), передаёт данные карты и сумму, и запрашивает предварительную проверку и блокировку этой суммы на счёте пользователя. Деньги пока не списаны, но они «заморожены».
Подтверждение оплаты: Пользователь вводит CVC/CVV-код или подтверждает платёж в банковском приложении (3-D Secure). Платёжный шлюз окончательно списывает заблокированные деньги и присылает оператору сигнал «Оплата прошла успешно».
Зачисление на счёт: Получив подтверждение, система оператора добавляет сумму пополнения к текущему балансу телефонного номера в базе данных.
Фиксация операции: В базу данных записывается полная история операции: номер телефона, сумма, дата/время, идентификатор платежа из банка. Это важно для отчётности и возможного возврата.
Завершение транзакции: Система фиксирует (commit) всю операцию. Все промежуточные изменения (новый баланс и запись в истории) становятся постоянными. Пользователь получает уведомление об успешном пополенеии
Если на любом из этих шагов (особенно между 2 и 4) что-то пошло не так (например, отключили свет в дата-центре), система откатит (rollback) все незавершённые изменения. Деньги либо не спишутся, либо (если уже списались) будет запущен процесс возврата, а баланс телефона не изменится.

2.1. Пополнение через автоплатёж (по расписанию)
Здесь система действует автоматически, но этапы схожи, просто добавляется «подготовительная фаза».
Срабатывание триггера: В заранее назначенную дату система планировщика видит: «У пользователя X активирован автоплатёж на сумму Y».
Предварительная проверка: Система перед списанием может проверить несколько условий: Активна ли услуга «Автоплатёж» у пользователя? Не изменился ли тариф/порог для автоплатежа? Достаточно ли средств для пополнения? (Это проверка на стороне оператора, чтобы не беспокоить банк впустую).
Начало транзакции и запрос в банк: Как и в обычном случае, начинается транзакция, и система отправляет в банк (по сохранённому токену карты, а не по её полным данным) запрос на списание фиксированной суммы.
Обработка результата от банка: Это ключевой момент. Если банк подтвердил списание система зачисляет деньги на баланс, фиксирует операцию и отправляет уведомление. Если банк отказал (например из-за недостатка денежных средств) система не зачисляет деньги, фиксирует в истории «Автоплатёж не выполнен», завершает транзакцию отказом.
Уведомление пользователя: Пользователю приходит СМС либо о успешном пополнении, либо о неудаче с просьбой обновить данные для автоплатежа.
Логирование для повторной попытки: В случае неудачи система может запланировать повторную попытку через день или два (в зависимости от правил оператора).

Главное отличие автоплатежа в том, что процесс полностью автоматический, инициированный системой, а не человеком. Поэтому важна логика обработки отказов со стороны банка, чтобы не создавать ошибочных списаний или долгов.
